#!/bin/bash
# Snitcher .bashrc - Lightweight configuration for remote access
# No dependencies on /cluster-nas - works offline

# If not running interactively, don't do anything
case $- in
    *i*) ;;
      *) return;;
esac

# Basic environment
export EDITOR="${EDITOR:-vim}"
export VISUAL="${VISUAL:-vim}"
export PAGER="${PAGER:-less}"

# History configuration
HISTCONTROL=ignoreboth
HISTSIZE=10000
HISTFILESIZE=20000
shopt -s histappend

# Shell options
shopt -s checkwinsize
shopt -s globstar 2>/dev/null
shopt -s autocd 2>/dev/null
shopt -s cdspell 2>/dev/null

# Path configuration
export PATH="$HOME/.local/bin:$HOME/bin:$PATH"

# Prompt
if [[ -x /usr/bin/tput ]] && tput setaf 1 >&/dev/null; then
    # Color prompt
    PS1='\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
else
    # Basic prompt
    PS1='\u@\h:\w\$ '
fi

# Basic aliases
alias ls='ls --color=auto 2>/dev/null || ls'
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# Directory navigation
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

# Safety aliases
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'

# Cluster shortcuts - use existing SSH config hosts
alias sshcrtr='ssh crtr'  # Uses existing SSH config
alias sshprtr='ssh prtr'  # Uses existing SSH config
alias sshdrtr='ssh drtr'  # Uses existing SSH config

# Smart routing alternatives (auto-detect local vs remote)
alias sshcrtr-smart='ssh crtr-smart'
alias sshprtr-smart='ssh prtr-smart'
alias sshdrtr-smart='ssh drtr-smart'

# Network detection helper
check_local_network() {
    ping -c 1 -W 1 192.168.254.10 &>/dev/null && echo "local" || echo "remote"
}

# Git shortcuts
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git log --oneline -10'
alias gd='git diff'

# Python virtual environment
if [[ -d "$HOME/.venv" ]]; then
    alias venv='source ~/.venv/bin/activate'
fi

# Load local customizations if they exist
if [[ -f "$HOME/.bashrc.local" ]]; then
    source "$HOME/.bashrc.local"
fi

# Enable programmable completion
if ! shopt -oq posix; then
    if [[ -f /usr/share/bash-completion/bash_completion ]]; then
        . /usr/share/bash-completion/bash_completion
    elif [[ -f /etc/bash_completion ]]; then
        . /etc/bash_completion
    fi
fi

# Welcome message (only for interactive shells)
if [[ -n "$PS1" ]]; then
    echo "🌐 Snitcher Remote Access Terminal"
    echo "📡 SSH hosts: crtr, prtr, drtr (your existing config)"
    echo "🔧 Smart routing: crtr-smart, prtr-smart, drtr-smart (auto-detects network)"
    echo "💡 Modern tools: eza, bat, fd, rg available"
fi