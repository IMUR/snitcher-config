#!/bin/bash
# Snitcher .bashrc - Lightweight configuration for remote access
# No dependencies on /cluster-nas - works offline

# If not running interactively, don't do anything
case $- in
    *i*) ;;
      *) return;;
esac

# Basic environment
export EDITOR="${EDITOR:-vim}"
export VISUAL="${VISUAL:-vim}"
export PAGER="${PAGER:-less}"

# History configuration
HISTCONTROL=ignoreboth
HISTSIZE=10000
HISTFILESIZE=20000
shopt -s histappend

# Shell options
shopt -s checkwinsize
shopt -s globstar 2>/dev/null
shopt -s autocd 2>/dev/null
shopt -s cdspell 2>/dev/null

# Path configuration
export PATH="$HOME/.local/bin:$HOME/bin:$PATH"

# Prompt
if [[ -x /usr/bin/tput ]] && tput setaf 1 >&/dev/null; then
    # Color prompt
    PS1='\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
else
    # Basic prompt
    PS1='\u@\h:\w\$ '
fi

# Basic aliases
alias ls='ls --color=auto 2>/dev/null || ls'
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# Directory navigation
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

# Safety aliases
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'

# Cluster access aliases (smart detection)
cluster_ssh() {
    local node="$1"
    local ip=""

    case "$node" in
        crtr|cooperator) ip="192.168.254.10" ;;
        prtr|projector)  ip="192.168.254.20" ;;
        drtr|director)   ip="192.168.254.30" ;;
        *) echo "Unknown node: $node"; return 1 ;;
    esac

    # Check if we can reach the node directly
    if ping -c 1 -W 1 "$ip" &>/dev/null; then
        # Direct connection
        ssh "${node}@${ip}"
    else
        # Use jump host (replace with your public IP)
        ssh -J crtr@47.155.237.161 "${node}@${ip}"
    fi
}

# Cluster shortcuts
alias sshcrtr='cluster_ssh crtr'
alias sshprtr='cluster_ssh prtr'
alias sshdrtr='cluster_ssh drtr'

# Git shortcuts
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git log --oneline -10'
alias gd='git diff'

# Python virtual environment
if [[ -d "$HOME/.venv" ]]; then
    alias venv='source ~/.venv/bin/activate'
fi

# Load local customizations if they exist
if [[ -f "$HOME/.bashrc.local" ]]; then
    source "$HOME/.bashrc.local"
fi

# Enable programmable completion
if ! shopt -oq posix; then
    if [[ -f /usr/share/bash-completion/bash_completion ]]; then
        . /usr/share/bash-completion/bash_completion
    elif [[ -f /etc/bash_completion ]]; then
        . /etc/bash_completion
    fi
fi

# Welcome message (only for interactive shells)
if [[ -n "$PS1" ]]; then
    echo "Snitcher Remote Access Terminal"
    echo "Cluster nodes: crtr, prtr, drtr"
    echo "Use 'sshcrtr', 'sshprtr', 'sshdrtr' for smart routing"
fi